(function(e){typeof define=="function"&&define.amd?define(["jquery"],e):e(jQuery)})(function(e){e.widget("ui.surface",{options:{size:200,name:"surface",background:'url("assets/img/graphy.png")',control:{size:20,start:null,color:"#275d74"},visible:{name:!0,values:!0},components:[{label:"component1",position:"top-left"},{label:"component2",position:"top-right"},{label:"component3",position:"bottom-right"},{label:"component4",position:"bottom-left"}]},_create:function(){this._surface=e("<div>");var t=this;this._values=[],this._controlHeight=this.getControlHeight(),this._maxRaw=this.getMaxRawValue(),this.options.control.start==null&&(this.options.control.start={left:this.options.size/2-this.options.control.size/2,top:this._controlHeight/2-this.options.control.size/2}),this._values=this.getValues(this.options.control.start),e.each(this.options.components,function(e,n){var r='<div class="component-name" style="">'+n.label+"</div>",i='<div class="component-point" style="width:'+t.options.control.size+"px;"+"height:"+t.options.control.size+"px;"+"line-height:"+t.options.control.size+'px;">'+t._values[e]+'<span class="postfix">%</span>'+"</div>";t._surface.append('<div class="component-container '+n.position+'" style="'+t.getPositionStyle(n.position)+'">'+i+r+"</div>\n")}),this._surface.append('<div class="control-point" style="top:'+this.options.control.start.top+"px;"+"left:"+this.options.control.start.left+"px;"+"width:"+this.options.control.size+"px;"+"height:"+this.options.control.size+"px;"+"background:"+this.options.control.color+";"+'"></div>');if(t.options.visible.name){var n=this.options.components.length==1?"transform:translate(-50%, 100%)":"";this._surface.append('<div class="surface-name" style="'+n+'">'+this.options.name+"</div>")}this.element.append(this._surface),this.element.css("width",this.options.size),this.element.css("height",this._controlHeight),this.element.css("border-radius",this.options.components.length!=1?this.options.control.size/2:this.options.size/2),this.element.css("background",this.options.background),this.element.addClass("select-surface-control"),this.element.click(function(n){var r=e(this).position().left,i=e(this).position().top,s={top:n.pageY-i,left:n.pageX-r},o={top:s.top,left:s.left};s.top+t.options.control.size>t._controlHeight&&(s.top=t._controlHeight-t.options.control.size),s.left+t.options.control.size>t.options.size&&(s.left=t.options.size-t.options.control.size),t.updateControlPoint(o),t._values=t.getValues(s),t.options.visible.values&&t.updateUiValues()}),e("#"+this.element.attr("id")+" .control-point").draggable({containment:"#"+this.element.attr("id"),cursorAt:{top:this.options.control.size/2,left:this.options.control.size/2},scroll:!1,drag:function(e,n){t._values=t.getValues(n.position),t.options.visible.values&&t.updateUiValues()},stop:function(e,n){t._values=t.getValues(n.position),t.options.visible.values&&t.updateUiValues()}})},values:function(){return this._values},getPositionStyle:function(e){var t=(this.options.size-this.options.control.size)/2;switch(e){case"top-left":return"top:0px;left:0px;";case"top":return"top: 0px;left:"+t+"px;";case"top-right":return"top:0px;right:"+this.options.control.size+"px;";case"right":return"top: "+t+"px;left:0px;";case"bottom-right":return"bottom:"+this.options.control.size+"px;right:"+this.options.control.size+"px;";case"bottom":return"bottom:"+this.options.control.size+"px;left:"+t+"px;";case"bottom-left":return"bottom:"+this.options.control.size+"px;left:0px;";case"left":return"top: "+t+"px;left:0px;";case"center":return"top: "+t+"px;left:"+t+"px;"}},updateControlPoint:function(t){t.top<this.options.control.size&&(t.top=this.options.control.size/2),t.top>this._controlHeight-this.options.control.size/2&&(t.top=this._controlHeight-this.options.control.size/2),t.left<this.options.control.size/2&&(t.left=this.options.control.size/2),t.left>this.options.size-this.options.control.size/2&&(t.left=this.options.size-this.options.control.size/2),t.top-=this.options.control.size/2,t.left-=this.options.control.size/2,e("#"+this.element.attr("id")+" .control-point").animate({top:t.top,left:t.left},250)},getControlHeight:function(){switch(this.options.components.length){case 1:return this.options.size;case 2:return this.options.control.size;case 3:return this.options.size*Math.sqrt(3)/2;case 4:return this.options.size}},getValues:function(e){var t=this.options.size-this.options.control.size,n=[],r=this;switch(this.options.components.length){case 1:n.push(this.distance({top:t/2,left:t/2},e));break;case 2:n.push(this.distance({top:0,left:0},e)),n.push(this.distance({top:0,left:t},e));break;case 3:n.push(this.distance({top:0,left:t/2},e)),n.push(this.distance({top:this._controlHeight,left:t},e)),n.push(this.distance({top:this._controlHeight,left:0},e));break;case 4:n.push(this.distance({top:0,left:0},e)),n.push(this.distance({top:0,left:t},e)),n.push(this.distance({top:t,left:t},e)),n.push(this.distance({top:t,left:0},e))}return n=_.map(n,function(e){var t=100-e*100/r._maxRaw;return t>0?t.toFixed(0):0}),n},updateUiValues:function(){var t='<span class="postfix">%</span>';switch(this.options.components.length){case 1:e("#"+this.element.attr("id")+" .center .component-point").html(this._values[0]+t);break;case 2:e("#"+this.element.attr("id")+" .top-left .component-point").html(this._values[0]+t),e("#"+this.element.attr("id")+" .top-right .component-point").html(this._values[1]+t);break;case 3:e("#"+this.element.attr("id")+" .top .component-point").html(this._values[0]+t),e("#"+this.element.attr("id")+" .bottom-right .component-point").html(this._values[1]+t),e("#"+this.element.attr("id")+" .bottom-left .component-point").html(this._values[2]+t);break;case 4:e("#"+this.element.attr("id")+" .top-left .component-point").html(this._values[0]+t),e("#"+this.element.attr("id")+" .top-right .component-point").html(this._values[1]+t),e("#"+this.element.attr("id")+" .bottom-right .component-point").html(this._values[2]+t),e("#"+this.element.attr("id")+" .bottom-left .component-point").html(this._values[3]+t)}},getMaxRawValue:function(){var e=this.options.size-this.options.control.size;switch(this.options.components.length){case 1:return e/2;case 4:return Math.sqrt(e*e*2);case 2:return e;case 3:return e}},distance:function(e,t){return Math.sqrt((t.left-e.left)*(t.left-e.left)+(t.top-e.top)*(t.top-e.top))},_setOption:function(t,n){e.Widget.prototype._setOption.apply(this,arguments)}})});